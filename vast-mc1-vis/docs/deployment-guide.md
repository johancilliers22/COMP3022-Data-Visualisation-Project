# Deployment Guide

This guide outlines the process for building and deploying the VAST Challenge visualization application. As the application relies on pre-processed data, ensuring this data is included in the deployment is crucial.

## 1. Prerequisites for Deployment

Before deploying, ensure you have:

1.  **Completed R Preprocessing (SEQUENTIALLY)**: The R scripts (`install_packages.R`, `data_preparation.R`, `analysis.R`, `process.R`) **must** have been run successfully **in that specific order**. This generates the essential data files in `vast-mc1-vis/public/data/processed/` that the frontend application requires. Refer to `preprocessing/README.md` or Section 8.1 of the main report for detailed execution steps.
2.  **Node.js and npm/yarn**: For building the React application.
3.  **Access to Deployment Target**: Credentials and access for your chosen hosting platform (e.g., GitHub Pages, Netlify, Vercel, static server).

## 2. Building the Application

1.  **Verify R Preprocessing Output**: Double-check that the required files (e.g., `all_summary_processed.csv`, `map_data.json`) exist in `vast-mc1-vis/public/data/processed/` after running the R scripts sequentially.
2.  **Install Frontend Dependencies**: If you haven't already, navigate to the `vast-mc1-vis` directory and run:
    ```bash
    npm install
    ```
3.  **Create Production Build**:
    ```bash
    npm run build
    ```
    This command bundles the React application and its assets into the `build/` directory. **Critically, the contents of the `public/` folder (including `public/data/processed/`) are automatically copied into the `build/` directory by the standard Create React App build process.**

4.  **Verify Build Contents (Optional but Recommended)**: Briefly inspect the `build/` directory. Confirm that it contains standard build artifacts (like `static/js/`, `static/css/`) and also the `data/` subdirectory with your GeoJSON and, most importantly, the `processed/` subfolder containing the necessary CSV and JSON files generated by the R pipeline.

5.  **Test Locally (Optional)**: Use a local static server to test the build:
    ```bash
    npx serve -s build
    # Application should be available at http://localhost:xxxx (port varies)
    ```

## 3. Deployment Options

The application is a static build and can be deployed to any static web hosting service. The key is to deploy the **entire contents of the `build` directory**.

### Option 1: GitHub Pages

(Follow standard `gh-pages` setup as described previously, ensuring your `package.json` is configured correctly. The `npm run deploy` script typically handles deploying the `build` folder).

1.  Install `gh-pages`: `npm install --save-dev gh-pages`
2.  Configure `package.json`:
    ```json
    "homepage": "https://<username>.github.io/<repository-name>",
    "scripts": {
      // ... other scripts
      "predeploy": "npm run build",
      "deploy": "gh-pages -d build"
    }
    ```
3.  Deploy: `npm run deploy`

### Option 2: Netlify

(Follow standard Netlify deployment, either via CLI or Git integration).
*   **Publish Directory**: Set to `build`.
*   **Build Command**: Typically `npm run build`.
*   Netlify will deploy the contents of the specified publish directory.

### Option 3: Vercel

(Follow standard Vercel deployment, either via CLI or Git integration).
*   Vercel usually auto-detects Create React App settings.
*   Ensure the **Output Directory** is set to `build` if configuring manually.

### Option 4: Other Static Web Servers (Apache, Nginx, S3, etc.)

1.  Run `npm run build`.
2.  Upload the **entire contents** of the generated `build/` directory to your server's configured web root or target directory.

## 4. Environment Configuration

(Configuration using `.env` files and `homepage` in `package.json` remains as previously described, if needed).

## 5. Post-Deployment Verification

After deploying, perform these crucial checks:

1.  **Load Application**: Access the deployed URL. Check for console errors.
2.  **Verify Data Loading**: Ensure the map, heatmap, and other charts load data. Interact with the time slider and category selectors – updates should occur.
3.  **Check Visualizations**: Confirm that neighborhoods are colored on the map and the heatmap displays data. Pay special attention to areas where data might have been sparse (like Wilson Forest) – they should show the placeholder (e.g., 0 damage / light blue) rather than appearing broken or completely blank.
4.  **Test Interactivity**: Ensure filters, time controls, and tooltips function correctly.

## 6. Troubleshooting Common Deployment Issues

*   **404 Errors (Especially for data files)**: Double-check that the `public/data/processed/` directory was correctly included in the `build` folder and uploaded during deployment. Verify file paths used in `dataLoader.js` or Vega specs are correct relative to the deployed application root.
*   **Application Loads but Visualizations are Empty/Broken**: This often points to issues loading or parsing the processed data files. Check browser network tab for failed requests (404s) for `.csv` or `.json` files. Check console for parsing errors.
*   **White Screen / Blank Page**: Usually indicates a JavaScript error during initialization. Check console. Could be related to incorrect `PUBLIC_URL` or routing issues if using client-side routing extensively (though less likely for this specific app structure).

By ensuring the R preprocessing is complete and the resulting `public/data/processed/` files are part of the deployed `build` directory, the application should function correctly on any static hosting platform.

## Environment Configuration

### Environment Variables

The application supports environment variables for configuration. Create a `.env` file in the project root with the following options:

```
# Public URL path (if not hosting at root)
PUBLIC_URL=/path/to/app

# API endpoint (if applicable)
REACT_APP_API_URL=https://api.example.com
```

For production builds, create a `.env.production` file with the production values.

### URL Path Configuration

If deploying to a subdirectory (not the root of the domain), update the `homepage` field in `package.json`:

```json
"homepage": "https://example.com/path/to/app",
```

## Post-Deployment Verification

After deploying, verify that:

1. The application loads correctly
2. Data is loaded and displayed
3. Visualizations render properly
4. Interactive features work as expected
5. There are no console errors

## Troubleshooting Deployment Issues

### Common Issues and Solutions

1. **White screen / blank page**:
   - Check browser console for errors
   - Verify that the `PUBLIC_URL` is set correctly
   - Ensure all required files are included in the build

2. **Missing assets (images, data files)**:
   - Verify that assets are in the correct location in the `public` directory. This includes GeoJSON files, any image assets, and critically, the pre-processed JSON data files (e.g., BSTS results usually found under `public/data/processed/`) that the application relies on.
   - Check that file paths used in the code (e.g., in `dataLoader.js` or Vega specs) correctly reference these deployed assets.

3. **CORS issues**:
   - Ensure data files are served from the same domain or a domain with proper CORS headers
   - Consider including data files in the build if possible

4. **Browser compatibility issues**:
   - Test in multiple browsers
   - Consider adding polyfills for older browsers

### Debugging Production Builds

1. Enable source maps for production:
   ```
   # .env.production
   GENERATE_SOURCEMAP=true
   ```

2. Use browser developer tools to inspect network requests, console errors, and component state.

## Continuous Deployment

For automated deployments, consider setting up continuous integration/continuous deployment (CI/CD) pipelines:

### GitHub Actions Example

Create a file at `.github/workflows/deploy.yml`:

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Node.js
      uses: actions/setup-node@v1
      with:
        node-version: '14'
        
    - name: Install dependencies
      run: npm ci
        
    - name: Build
      run: npm run build
        
    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
        branch: gh-pages
        folder: build
```

## Performance Optimization

To optimize the deployed application:

1. Enable text compression on your web server
2. Set up appropriate caching headers for static assets
3. Consider using a Content Delivery Network (CDN) for serving assets
4. Implement lazy loading for large visualizations
5. Monitor application performance using tools like Lighthouse or WebPageTest

## Security Considerations

1. Ensure your web server has appropriate security headers
2. Keep dependencies updated regularly
3. Use HTTPS for all deployed instances
4. Be mindful of exposing sensitive data in client-side code

## Updating a Deployed Application

To update an already deployed application:

1. Make and test your changes locally
2. Build the application with `npm run build`
3. Deploy using the same method used for the initial deployment
4. Verify the changes on the deployed site 